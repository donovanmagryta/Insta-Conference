<!DOCTYPE html>
<html>
<style>
video {
  width: 40%;
  border-radius:15px;
  margin: 5px 10px;
  }
  body {
 font-family: Arial;
  }
</style>
<body>

<h1>Instant Video Chat & File Sharing</h1>
  <h2>No registration or download needed!</h2>
  <p>Simply accept camera and microphone permissions, pick a room name, and a time to meet.</p>
  <p>Anyone who has the room name can join.</p>
<!-- <input type="file" id="share-file"/>-->
  <button id="share-file">share file</button>


<!--<script src="https://rtcmulticonnection.herokuapp.com/dist/RTCMultiConnection.min.js"></script>-->
<script src="https://rtcmulticonnection.herokuapp.com/socket.io/socket.io.js"></script>
 <!--<script src="https://cdn.webrtc-experiment.com:443/FileBufferReader.js"></script>-->
 <!-- <script src="https://cdn.webrtc-experiment.com/FileBufferReader.js"></script>-->
  <script src="FileBufferReader.js"></script>
  <!--<script src="socket.io.js"></script>-->
  <script src="RTCMultiConnection.min.js"></script>
<script>
  // Let's check if the browser supports notifications
  if (!("Notification" in window)) {
    alert("This browser does not support desktop notification");
  }

  // Let's check whether notification permissions have already been granted
  //else if (Notification.permission === "granted") {
    
   // var notification = new Notification("Hi there!");
    // If it's okay let's create a notification
  //}

  // Otherwise, we need to ask the user for permission
  else if (Notification.permission !== "denied") {
    Notification.requestPermission(function (permission) {
      // If the user accepts, let's create a notification
     // if (permission === "granted") {
        
     // }
    });
  }

  // At last, if the user has denied notifications, and you 
  // want to be respectful there is no need to bother them any more.
  

var connection = new RTCMultiConnection();

// this line is VERY_important
connection.socketURL = 'https://rtcmulticonnection.herokuapp.com:443/';
connection.autoSaveToDisk = false;
connection.enableFileSharing = true;

// all below lines are optional; however recommended.

connection.session = {
    audio: true,
    video: true,
    data:   true
    //screen: true,
    //oneway: true
};


connection.sdpConstraints.mandatory = {
    OfferToReceiveAudio: true,
    OfferToReceiveVideo: true
};

connection.onstream = function(event) {
    document.body.appendChild( event.mediaElement );
  //var notification = new Notification("New Call!");
};

var predefinedRoomId = prompt('Please enter your meeting room name (Anyone with the name can join.)');
  
connection.openOrJoin(predefinedRoomId);
 /* 
function sendy() {
document.querySelector('input[type=file]').onchange = function() {
    connection.send(this.files[0]);
};
};
  */
  document.getElementById('share-file').onclick = function() {
    var fileSelector = new FileSelector();
    fileSelector.selectSingleFile(function(file) {
        connection.send(file);
    });
};

  var me = connection.userid;
  connection.sendCustomMessage(me);
  
  connection.onCustomMessage = function(message) {
  if (message != me) {
    var notification = new Notification("New Caller!");
  }
  };
//connection.sendCustomMessage({
    //userOnline: true,
    //userid: connection.userid
//});
  /*
if (connection.newParticipant === true) {
  var notification = new Notification("New Call!");
};
*/
 
</script>
</body>
</html>
